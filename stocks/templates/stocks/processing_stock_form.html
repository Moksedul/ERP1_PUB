{% extends "main/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
    <div class="text-center form-title">{{tittle}}</div>
            <div class="table-container">
                <div id="person_image" class="col-md"></div>
                <form method="post"  id="buyForm" data-image-url="{% url 'load-person-image' %}" novalidate>
                    {% csrf_token %}
                 <div class="form-row">
                <div class="col-12 border border-info rounded">
                    {{ form2set.management_form }}
                    <div id="form_set" class="form-row">
                        {% for form in form2set.forms %}
                            <div class='no_error'>
                                {{ form2.as_table }}
                            </div>
                        {% endfor %}
                    </div>
                    <span title="add more" id="add_more" style="float: right;" class="rounded add-more border border-info">+</span>
                    <div id="empty_form" style="display:none">
                        <div class='no_error'>
                            {{ form2set.empty_form.as_table }}
                        </div>
                    </div>
                </div>

                <div class="form-group col-md-4 mb-0" >
                   {{ form.remarks|as_crispy_field }}
                </div>
                <button class="btn btn-sm btn-outline-info" type="submit">{{button_name}}</button>
                </div>
        </form>
    </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
$(document).ready(function ()
{
   var $select1 = $('#id_seller_name');
       $select1.on('change',function()
       {
            var url2 = $("#buyForm").attr("data-image-url");
            var nameId = $(this).val();
             $.ajax({
                        url: url2,
                        data: {
                          'name': nameId
                        },
                        success: function (data) {
                          $("#person_image").html(data);
                        }
                  });
       }).trigger('change');
});
</script>

<script>
    $(document).ready(function ()
{
    var totalForms = $('#id_{{formset_name}}-TOTAL_FORMS').val();

      for (let i = 0; i < totalForms; i++) {
                $("#id_{{formset_name}}-"+ i +"-product").select2({});
            }
    $("#id_business_name").select2({});
    $("#id_seller_name").select2({});
    $("#id_bazar_or_company_name").select2({});

   var addMore = $('#add_more')
   var productTitle = $('.product')
   var lastProductTitle = productTitle[productTitle.length-2]
   $(lastProductTitle).append(addMore)

});

</script>

<script>
    $('#add_more').click(function() {

        var form_idx = $('#id_{{formset_name}}-TOTAL_FORMS').val();
        $('#form_set').append($('#empty_form').html().replace(/__prefix__/g, form_idx));
        $('#id_{{formset_name}}-TOTAL_FORMS').val(parseInt(form_idx) + 1);
        var id = "#id_{{formset_name}}-" + form_idx + "-product"
        $(id).select2({});

        var productTitle = $('.product')
        var lastProductTitle = productTitle[productTitle.length-2]
        var textProduct = 'Product-'  + (productTitle.length-1)
        $(lastProductTitle).text(textProduct);
        $(lastProductTitle).append(this)

    });
</script>

<script src="/static/main/js/responsive.content.height.js"></script>

{% endblock content %}